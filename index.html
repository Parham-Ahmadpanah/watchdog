<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Anti‑Theft Guardian v2.0 — Secure Your Device</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Buy or activate Anti‑Theft Guardian v2.0 license easily and securely.">
<link rel="icon" href="icon.png">
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;margin:0;background:#f8fbff;color:#111}
  .container{max-width:450px;margin:3rem auto;background:#fff;border-radius:10px;
             box-shadow:0 6px 25px #0001;padding:2rem}
  h1,h2{text-align:center;margin:0 0 1.5rem}
  .btn{display:inline-block;background:#0078d7;color:#fff;border:0;border-radius:4px;
       padding:.8rem 2.2rem;font-weight:600;cursor:pointer;box-shadow:0 2px 8px #0078d733}
  .btn:hover{background:#005ea5}
  .hidden{display:none!important}
  .field{margin-bottom:1.3rem}
  label{display:block;margin-bottom:.4rem;font-weight:500}
  input[type=email],input[type=text]{width:100%;padding:.7em;border:1px solid #ccc;border-radius:5px}
  .err{color:#d00;margin-top:.6em}
  .msg{color:#090}
  #paypal-button-container{margin-top:1.6rem}
  #logout{float:right;background:#eee;color:#333;margin-top:-1.4rem}
  footer{text-align:center;margin:2rem 0 0;font-size:.9rem;color:#888}
  .feature-list{list-style:none;padding-left:0}
  .feature-list li:before{content:'✓ ';color:#0078d7}
</style>

<!-- ✅ Google reCAPTCHA v2 Invisible  -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<!-- ✅ PayPal Smart Buttons -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID"></script>
</head>

<body>
<div class="container">
  <!-- LANDING -->
  <section id="landing">
    <h1>Anti‑Theft Guardian v2.0</h1>
    <h2>Defend your laptop from physical theft</h2>
    <ul class="feature-list">
      <li>Instant unplug alarm</li>
      <li>Shutdown prevention</li>
      <li>One‑device lifetime license</li>
      <li>Windows 10/11 Compatible</li>
    </ul>
    <button class="btn" onclick="goLogin()">Get Started</button>
  </section>

  <!-- LOGIN / SIGN‑UP -->
  <section id="login" class="hidden">
    <h2>Your Email for Activation</h2>
    <form id="login-form" onsubmit="return false;">
      <div class="field">
        <label>Email address</label>
        <input type="email" id="email" required placeholder="you@example.com">
        <div class="err" id="errMsg"></div>
      </div>
      <button class="g-recaptcha btn"
              data-sitekey="YOUR_RECAPTCHA_SITE_KEY"
              data-callback="submitHuman"
              data-action="submit">Continue</button>
    </form>
  </section>

  <!-- USER PANEL -->
  <section id="panel" class="hidden">
    <button id="logout" onclick="doLogout()">⎋ Logout</button>
    <h2>Welcome, <span id="user-email"></span></h2>
    <div id="status"></div>
  </section>
</div>

<footer>© 2025 Parham Panah · <a href="https://parhampanah.com">Main Site</a>
  <style>
  .trust-badges{text-align:center;margin-top:2rem}
  .trust-badges img{height:40px;margin:0 .6rem;vertical-align:middle}
  .trust-links{font-size:.85rem;color:#777;margin-top:.6rem}
  .trust-links a{color:#0078d7;text-decoration:none}
  .trust-links a:hover{text-decoration:underline}
  </style>
  
  <div class="trust-badges">
    <img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_111x69.jpg" alt="PayPal Secure Checkout">
    <img src="https://img.icons8.com/color/48/000000/ssl-certificate.png" alt="SSL Secured">
    <img src="https://img.icons8.com/color/48/000000/protect.png" alt="Safe Purchase Guarantee">
    <div class="trust-links">
      <a href="policy.html">Privacy Policy</a> • 
      <a href="support.html">Contact Support</a> • 
      <a href="https://parhampanah.com">Official Website</a>
    </div>
  </div>
</footer>

<script>
const backend="https://watchdog.parhampanah.com"; // FastAPI domain
const q=s=>document.querySelector(s);

// ===== View control =====
function view(v){["#landing","#login","#panel"].forEach(id=>q(id).classList.add("hidden"));
q(v).classList.remove("hidden");}
function goLogin(){view("#login");}
function goPanel(){view("#panel");loadPanel();}

// ===== User state =====
function getUser(){return localStorage.getItem('atg_email');}
function setUser(e){localStorage.setItem('atg_email',e);}
function clearUser(){localStorage.removeItem('atg_email');location.reload();}

window.onload=()=>{getUser()?goPanel():view("#landing");};

// ===== reCAPTCHA callback =====
function submitHuman(token){
 const email=q("#email").value.trim().toLowerCase();
 if(!email){q("#errMsg").textContent="Please enter email.";return;}
 fetch(`${backend}/check-captcha`,{
   method:"POST",headers:{"Content-Type":"application/json"},
   body:JSON.stringify({token,email})
 }).then(r=>r.json()).then(resp=>{
   if(!resp.human){q("#errMsg").textContent="Robot check failed.";grecaptcha.reset();}
   else {
     // call signup/login on backend
     fetch(`${backend}/login`,{
       method:"POST",headers:{"Content-Type":"application/json"},
       body:JSON.stringify({email})
     }).then(r=>r.json()).then(d=>{
        if(d.status==="not_found"){  // auto‑sign‑up
          fetch(`${backend}/signup`,{
            method:"POST",headers:{"Content-Type":"application/json"},
            body:JSON.stringify({email})
          });
        }
        setUser(email);goPanel();
     });
   }
 });
}

// ===== Logout =====
function doLogout(){clearUser();}

// ===== Panel loading =====
function loadPanel(){
 const email=getUser(); q("#user-email").textContent=email;
 const s=q("#status"); s.innerHTML="Loading license status …";
 fetch(`${backend}/verify/${encodeURIComponent(email)}`)
 .then(r=>r.json()).then(d=>{
    if(d.status==="licensed"&&d.code){
       s.innerHTML=`<div class='msg'>✅ Licensed</div>
       <p>Your Activation Code:</p>
       <input style="width:80%" readonly value="${d.code}">
       <button onclick="navigator.clipboard.writeText('${d.code}')">Copy</button>`;
    } else {
       s.innerHTML=`<div class='err'>No license detected.</div>
       <div id='paypal-button-container'></div>
       <p style="font-size:.9em;color:#777">or enter existing code:</p>
       <input id="manual-code" placeholder="Paste activation code">
       <button onclick="enterCode()">Activate</button>`;
       renderPayPal(email);
    }
 })
 .catch(()=>s.innerHTML="<div class='err'>Server not reachable.</div>");
}

// ===== PayPal Buttons =====
function renderPayPal(email){
 paypal.Buttons({
   style:{shape:"pill",color:"blue",label:"paypal"},
   createOrder:(data,actions)=>actions.order.create({
     purchase_units:[{
       description:"Anti‑Theft Guardian v2.0 License",
       amount:{currency_code:"USD",value:"14.99"}
     }]
   }),
   onApprove:(data,actions)=>actions.order.capture().then(det=>{
     fetch(`${backend}/payment-success`,{
       method:"POST",headers:{"Content-Type":"application/json"},
       body:JSON.stringify({
         email,order_id:data.orderID,
         payer_email:det.payer.email_address,
         payer_name:det.payer.name.given_name
       })
     }).then(r=>r.json()).then(()=>{
        alert("✅ Payment successful! Check your email for the activation code.");
        loadPanel();
     }).catch(()=>alert("Payment OK but server error. Please forward receipt to support."));
   }),
   onError:()=>alert("Payment failed, please retry.")
 }).render("#paypal-button-container");
}

// ===== Manual code entry =====
function enterCode(){
 const email=getUser(),code=q("#manual-code").value.trim();
 if(!code){alert("Enter your code.");return;}
 fetch(`${backend}/verify-code`,{
   method:"POST",headers:{"Content-Type":"application/json"},
   body:JSON.stringify({email,code})
 }).then(r=>r.json()).then(d=>{
   if(d.ok){alert("✅ Activated!");loadPanel();}
   else alert("Invalid code.");
 });
}
</script>
</body>
</html>
